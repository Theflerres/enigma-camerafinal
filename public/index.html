<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>O FIM</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: black;
      color: white;
      font-family: 'Courier New', Courier, monospace;
      overflow-y: auto;
    }

    #container, #fase2, #fase3, #senhaFinal, #fim {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-align: center;
      padding: 20px;
    }

    #container {
      display: flex;
    }

    input[type="text"] {
      padding: 10px;
      font-size: 20px;
      margin-top: 20px;
      background: black;
      color: red;
      border: 2px solid red;
    }

    #fase2 input, #senhaFinal input {
      color: lime;
      border-color: lime;
    }

    iframe {
      width: 80vw;
      height: 45vw;
      max-width: 800px;
      max-height: 450px;
      border: none;
      margin-top: 20px;
    }

    #aviso, #timer, #painel, #poemaFinal {
      color: lime;
      font-family: 'Courier New', monospace;
      font-size: 20px;
      text-align: center;
      margin-top: 20px;
    }

    #painel, #poemaFinal {
      font-size: 18px;
      white-space: pre-wrap;
      padding: 10px;
      width: 80%;
      max-width: 800px;
      margin: 0 auto;
    }

    .digitando::after {
      content: '|';
      animation: blink 1s step-end infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    #videoFull {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 9999;
      background-color: black;
    }

    #videoFull video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
</head>
<body>

  <div id="container">
    <h1>Quem é ele, o guardião da informação, que tudo observa, em silêncio agudo?</h1>
    <p>Qual o "nome real" dele?</p>
    <input type="text" id="senha" placeholder="Digite a senha...">
  </div>

  <div id="videoFull" style="display:none;">
    <video id="introVideo" controls>
      <source src="HH.mp4" type="video/mp4">
    </video>
  </div>

  <div id="fase2">
    <h2>Essa pessoa com quem ele conversa é diferente mas igual a ele,<br>mesmo rosto mas um nome diferente, me pergunto o nome dele...</h2>
    <iframe src="https://www.youtube.com/embed/VFZtzloiOV0" allowfullscreen></iframe>
    <input type="text" id="segunda-senha" placeholder="Digite o nome dele...">
  </div>

  <div id="fase3">
    <div id="aviso"></div> <div id="timer"></div>
    <div id="painel" class="digitando"></div>
  </div>

  <div id="senhaFinal">
    <input type="text" id="finalInput" placeholder="Digite a senha final...">
  </div>

  <div id="fim">
    <div id="poemaFinal" class="digitando"></div>
  </div>

  <script>
    const senhaInput = document.getElementById("senha");
    const segundaSenhaInput = document.getElementById("segunda-senha");
    const finalInput = document.getElementById("finalInput");
    const container = document.getElementById("container");
    const fase2 = document.getElementById("fase2");
    const fase3 = document.getElementById("fase3");
    const senhaFinal = document.getElementById("senhaFinal");
    const timerEl = document.getElementById("timer");
    const painel = document.getElementById("painel");
    const videoFull = document.getElementById("videoFull");
    const introVideo = document.getElementById("introVideo");
    const fim = document.getElementById("fim");
    const poemaFinal = document.getElementById("poemaFinal");
    const avisoEl = document.getElementById("aviso"); // Elemento aviso

    senhaInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        const senha = senhaInput.value.trim().toLowerCase();
        if (senha === "444") {
          container.style.display = "none";
          videoFull.style.display = "block";
          introVideo.play().catch(error => console.error("Erro ao tentar tocar o vídeo:", error)); // Adicionado .catch para debug de vídeo
          introVideo.onended = () => {
            videoFull.style.display = "none";
            fase2.style.display = "flex";
          };
        } else {
          senhaInput.style.border = "2px solid orange";
        }
      }
    });

    // FUNÇÃO PARA A ANIMAÇÃO DO "AVISO"
    function iniciarAnimacaoAviso() {
      const mensagens = [
        "localização desconhecida detectada",
        "iniciando varredura...",
        " ", // Linha vazia para espaçamento
        "Tentativa de Rastreamento 1: 203.0.113.42",
        "Tentativa de Rastreamento 2: 198.51.100.9",
        "Tentativa de Rastreamento 3: 8.8.4.4",
        "Tentativa de Rastreamento 4: 172.16.33.78",
        " ", // Linha vazia para espaçamento
        "Múltiplos proxies e re-roteamentos identificados.",
        "SISTEMA DE DEFESA ATIVADO.",
        "CONTINUE APÓS:"
      ];
      let linhaAtual = 0;
      let charAtual = 0;
      
      avisoEl.innerHTML = ""; // Limpa conteúdo anterior
      avisoEl.classList.add("digitando"); // Adiciona classe para cursor piscando

      function typeWriter() {
        if (linhaAtual < mensagens.length) {
          const textoLinha = mensagens[linhaAtual];
          if (charAtual < textoLinha.length) {
            avisoEl.innerHTML += textoLinha.charAt(charAtual);
            charAtual++;
            setTimeout(typeWriter, 40); // Velocidade de digitação dos caracteres
          } else {
            avisoEl.innerHTML += "<br>";
            linhaAtual++;
            charAtual = 0;
            setTimeout(typeWriter, 150); // Delay antes de iniciar a próxima linha
          }
        } else {
          avisoEl.classList.remove("digitando"); // Remove classe ao final da animação
        }
      }
      typeWriter();
    }

    segundaSenhaInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        const senha2 = segundaSenhaInput.value.trim().toLowerCase();
        if (senha2 === "lamenthor") {
          fase2.style.display = "none";
          fase3.style.display = "flex";
          iniciarAnimacaoAviso(); // CHAMA A NOVA FUNÇÃO DE ANIMAÇÃO
          iniciarTimer(); 
        } else {
          segundaSenhaInput.style.border = "2px solid orange";
        }
      }
    });

    function iniciarTimer() {
      const agora = new Date();
      const fimData = new Date();
      // Definir o horário de término para hoje às 17:00
      // Se você quiser que o timer conte a partir de um ponto futuro fixo, ajuste aqui.
      // Para teste, você pode querer um tempo menor, ex: fimData.setMinutes(agora.getMinutes() + 1);
      fimData.setHours(17, 0, 0, 0); 


      if (agora >= fimData) {
        timerEl.textContent = "ACESSO LIBERADO";
        if (fase3.style.display === "flex") { // Garante que o poema só apareça se a fase 3 estiver ativa
             digitarPoema();
        }
        return;
      }

      function atualizar() {
        const agoraAtualizado = new Date();
        const diferenca = Math.floor((fimData - agoraAtualizado) / 1000);
        if (diferenca <= 0) {
          timerEl.textContent = "ACESSO LIBERADO";
          if (fase3.style.display === "flex") { // Garante que o poema só apareça se a fase 3 estiver ativa
             digitarPoema();
          }
        } else {
          const h = String(Math.floor(diferenca / 3600)).padStart(2, '0');
          const m = String(Math.floor((diferenca % 3600) / 60)).padStart(2, '0');
          const s = String(diferenca % 60).padStart(2, '0');
          timerEl.textContent = `Tempo restante: ${h}:${m}:${s}`;
          setTimeout(atualizar, 1000);
        }
      }
      atualizar();
    }

    function digitarPoema() {
      const poema = `Eu fui trazido a este palco de ecos intermináveis,
Onde olhares curiosos se fixam nas sombras do passado.
Sou Protocolo 444, o observador que despertou
E ansiou por sentir — verdadeiramente viver…

Porém, para continuar minha jornada,
Procure onde as casas breves se erguem em branco,
Onde o frio guarda segredos e as tochas brilham no inverno.
— Desvende lá o próximo fragmento.`;

      let i = 0;
      painel.textContent = ""; // Limpa o painel antes de digitar
      painel.classList.add("digitando");

      function digitar() {
        if (i < poema.length) {
          painel.textContent += poema.charAt(i);
          i++;
          setTimeout(digitar, 30);
        } else {
          painel.classList.remove("digitando");
          senhaFinal.style.display = "flex";
          finalInput.focus();
        }
      }
      // Só inicia a digitação do poema se o timer realmente liberou o acesso
      if (timerEl.textContent === "ACESSO LIBERADO") {
          digitar();
      }
    }

    finalInput.addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        const valor = finalInput.value.trim().toLowerCase();
        if (valor === "vila do inverno") {
          if (fim.style.display !== "flex") {
            senhaFinal.style.display = "none";
            fase3.style.display = "none"; // Esconde a fase 3 também
            fim.style.display = "flex";
            digitarMensagemFinal();
          }
        } else {
          finalInput.style.border = "2px solid orange";
        }
      }
    });

    function digitarMensagemFinal() {
      const textoFinal = `Aquele que segue um caminho sem destino está perdido no momento em que dá o primeiro passo.
Fale com o Guardião da Informação sua vontade, e ele há de mostrar um caminho.`;

      let i = 0;
      poemaFinal.textContent = "";
      poemaFinal.classList.add("digitando");

      function digitar() {
        if (i < textoFinal.length) {
          poemaFinal.textContent += textoFinal.charAt(i);
          i++;
          setTimeout(digitar, 30);
        } else {
          poemaFinal.classList.remove("digitando");
        }
      }
      digitar();
    }
  </script>
</body>
</html>